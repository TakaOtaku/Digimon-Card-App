<p-contextMenu #table [model]="deckRowContext"></p-contextMenu>

<p-table
  [(contextMenuSelection)]="selectedDeck"
  [contextMenu]="table"
  [globalFilterFields]="['', 'color.name', 'title', '', 'tags.0.name', 'user', '']"
  [paginator]="true"
  [rowsPerPageOptions]="[25, 50, 75]"
  [rows]="25"
  [scrollHeight]="'calc(100vh - 100px)'"
  [scrollable]="true"
  [showCurrentPageReport]="true"
  [value]="decks"
  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} decks"
  dataKey="title"
  styleClass="p-datatable-striped"
>
  <ng-template pTemplate="header">
    <tr>
      <th class="max-w-[50px]"></th>
      <th class="max-w-[120px]">
        <div class="mx-auto">
          Color
          <p-columnFilter display="menu" field="color.name" matchMode="equals">
            <ng-template
              let-filter="filterCallback"
              let-value
              pTemplate="filter"
            >
              <p-dropdown
                (onChange)="filter($event.value)"
                [ngModel]="value"
                [options]="colors"
                placeholder="Any"
              >
                <ng-template let-option pTemplate="item">
                  <span [class]="'customer-badge status-' + option">{{
                    option
                  }}</span>
                </ng-template>
              </p-dropdown>
            </ng-template>
          </p-columnFilter>
        </div>
      </th>
      <th class="max-w-[600px] max-w-[100%]">
        <div class="mx-auto">
          Title
          <p-columnFilter
            display="menu"
            field="title"
            type="text"
          ></p-columnFilter>
        </div>
      </th>
      <th class="max-w-[400px] max-w-[100%]">
        <div class="mx-auto">Description</div>
      </th>
      <th class="max-w-[100%]max-w-[400px] max-w-[100%]">
        <div class="mx-auto">Tags
          <p-columnFilter display="menu" field="tags.0.name" matchMode="contains">
            <ng-template
              let-filter="filterCallback"
              let-value
              pTemplate="filter"
            >
              <p-dropdown
                (onChange)="filter($event.value);"
                [ngModel]="value"
                [options]="tags"
                placeholder="Any"
              >
                <ng-template let-option pTemplate="item">
                  <span [class]="'customer-badge status-' + option">{{
                    option
                    }}</span>
                </ng-template>
              </p-dropdown>
            </ng-template>
          </p-columnFilter>
        </div>
      </th>
      <th class="max-w-[400px] max-w-[100%]">
        <div class="mx-auto">
          User
          <p-columnFilter
            display="menu"
            field="user"
            type="text"
          ></p-columnFilter>
        </div>
      </th>
      <th class="max-w-[400px] max-w-[100%]" pSortableColumn="date">
        <div class="mx-auto">
          Date
          <p-sortIcon field="date"></p-sortIcon>
        </div>
      </th>
    </tr>
  </ng-template>
  <ng-template let-deck let-expanded="expanded" pTemplate="body">
    <tr
      class="max-h-[50px]"
      (dblclick)="showContextMenu(table, $event, deck)"
      [pContextMenuRow]="deck"
    >
      <td class="max-w-[50px]">
        <button
          [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
          [pRowToggler]="deck"
          class="p-button-text p-button-rounded p-button-plain"
          pButton
          pRipple
          type="button"
        ></button>
      </td>
      <td class="inline-flex max-w-[120px]">
        <img
          [src]="deck.color?.img ?? 'assets/decks/white.svg'"
          alt="Digimon Deck Image"
          class="mx-auto max-h-[50px]"
        />
      </td>
      <td class="max-w-[600px]">{{ deck.title }}</td>
      <td class="max-w-[400px] max-w-[100%] truncate">
        {{ deck.description }}
      </td>
      <td class="max-w-[400px] max-w-[100%]">
        <div class="mx-auto">
          <p-chip *ngFor="let tag of deck.tags" label="{{ tag.name }}"></p-chip>
        </div>
      </td>
      <td class="max-w-[400px] max-w-[100%]">
        <div class="mx-auto">
          {{ deck.user }}
        </div>
      </td>
      <td class="max-w-[400px] max-w-[100%]">
        <div class="mx-auto">
          {{ dateFormat(deck.date) }}
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template let-deck pTemplate="rowexpansion">
    <tr>
      <td colspan="7">
        <div class="card-list surface-card flex flex-wrap pt-3">
          <div *ngFor="let card of deck.cards">
            <digimon-deck-card
              [card]="card"
              [cards]="allCards"
              [edit]="false"
              [fullCards]="false"
            ></digimon-deck-card>
          </div>
        </div>
      </td>
    </tr>
  </ng-template>
</p-table>
